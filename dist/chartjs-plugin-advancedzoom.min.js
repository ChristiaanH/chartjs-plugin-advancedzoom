/*!
 * @license
 * chartjs-plugin-advancedzoom
 * http://chartjs.org/
 * Version: 0.7.3
 *
 * Copyright 2019 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-plugin-advancedzoom/blob/master/LICENSE.md
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("hammerjs")):"function"==typeof define&&define.amd?define(["hammerjs"],n):(e=e||self).ChartAdvancedZoom=n(e.Hammer)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var n=Chart.helpers,o=Chart.AdvancedZoom=Chart.AdvancedZoom||{};var a=o.zoomFunctions=o.zoomFunctions||{},t=o.panFunctions=o.panFunctions||{};function i(e,n){var o=e.$advancedzoom._node=e.ctx.canvas,a=e.$advancedzoom;e.$advancedzoom._options=n;var t=n.zoom&&n.zoom.enabled,i=n.zoom.drag;t?(o.addEventListener("wheel",a._wheelHandler),i&&(o.addEventListener("mousedown",a._mouseDownHandler),o.ownerDocument.addEventListener("mouseup",a._mouseUpHandler))):(o.removeEventListener("wheel",a._wheelHandler),o.removeEventListener("mousedown",a._mouseDownHandler),o.removeEventListener("mousemove",a._mouseMoveHandler),o.ownerDocument.removeEventListener("mouseup",a._mouseUpHandler))}function r(e){var o=e.$advancedzoom._originalOptions;n.each(e.scales,function(e){o[e.id]||(o[e.id]=n.clone(e.options))}),n.each(o,function(n,a){e.scales[a]||delete o[a]})}function l(e,n){return void 0===e||"string"==typeof e&&-1!==e.indexOf(n)}function m(e,o){if(e.scaleAxes&&e.rangeMax&&!n.isNullOrUndef(e.rangeMax[e.scaleAxes])){var a=e.rangeMax[e.scaleAxes];o>a&&(o=a)}return o}function d(e,o){if(e.scaleAxes&&e.rangeMin&&!n.isNullOrUndef(e.rangeMin[e.scaleAxes])){var a=e.rangeMin[e.scaleAxes];o<a&&(o=a)}return o}function c(e,n,o,a){var t=e.max-e.min,i=t*(n-1),r=e.isHorizontal()?o.x:o.y,l=(e.getValueForPixel(r)-e.min)/t,c=i*l,s=i*(1-l);e.options.ticks.min=d(a,e.min+c),e.options.ticks.max=m(a,e.max-s)}function s(e,n,o,t){var i=a[e.type];i&&i(e,n,o,t)}function u(e,o,a,t,i,m){var d=e.chartArea;t||(t={x:(d.left+d.right)/2,y:(d.top+d.bottom)/2}),void 0===m&&(m=!0);var c=e.$advancedzoom._options.zoom;if(c.enabled){r(e);var u,v=c.mode;u="xy"===v&&void 0!==i?i:"xy",n.each(e.scales,function(e){e.isHorizontal()&&l(v,"x")&&l(u,"x")?(c.scaleAxes="x",s(e,o,t,c)):!e.isHorizontal()&&l(v,"y")&&l(u,"y")&&(c.scaleAxes="y",s(e,a,t,c))}),m&&e.update(0),"function"==typeof c.onZoom&&c.onZoom({chart:e})}}function v(e,o,a){var t,i=e.options.ticks,r=e.min,l=e.max,m=e.getValueForPixel(e.getPixelForValue(r)-o),d=e.getValueForPixel(e.getPixelForValue(l)-o),c=m=m.valueOf?m.valueOf():m,s=d=d.valueOf?d.valueOf():d;a.scaleAxes&&a.rangeMin&&!n.isNullOrUndef(a.rangeMin[a.scaleAxes])&&(c=a.rangeMin[a.scaleAxes]),a.scaleAxes&&a.rangeMax&&!n.isNullOrUndef(a.rangeMax[a.scaleAxes])&&(s=a.rangeMax[a.scaleAxes]),m>=c&&d<=s?(i.min=m,i.max=d):m<c?(t=r-c,i.min=c,i.max=l-t):d>s&&(t=s-l,i.max=s,i.min=r+t)}function f(e,n,o){var a=t[e.type];a&&a(e,n,o)}function p(e,o,a){r(e);var t=e.$advancedzoom._options.pan;if(t.enabled){var i=t.mode;n.each(e.scales,function(e){e.isHorizontal()&&l(i,"x")&&0!==o?(t.scaleAxes="x",f(e,o,t)):!e.isHorizontal()&&l(i,"y")&&0!==a&&(t.scaleAxes="y",f(e,a,t))}),e.update(0),"function"==typeof t.onPan&&t.onPan({chart:e})}}Chart.AdvancedZoom.defaults=Chart.defaults.global.plugins.advancedzoom={pan:{enabled:!1,mode:"xy",speed:20,threshold:10},zoom:{enabled:!0,mode:"x",sensitivity:3,speed:.1}},o.zoomFunctions.category=function(e,n,a,t){var i=e.chart.data.labels,r=e.minIndex,l=i.length-1,c=e.maxIndex,s=t.sensitivity,u=e.isHorizontal()?e.left+e.width/2:e.top+e.height/2,v=e.isHorizontal()?a.x:a.y;o.zoomCumulativeDelta=n>1?o.zoomCumulativeDelta+1:o.zoomCumulativeDelta-1,Math.abs(o.zoomCumulativeDelta)>s&&(o.zoomCumulativeDelta<0?(v>=u?r<=0?c=Math.min(l,c+1):r=Math.max(0,r-1):v<u&&(c>=l?r=Math.max(0,r-1):c=Math.min(l,c+1)),o.zoomCumulativeDelta=0):o.zoomCumulativeDelta>0&&(v>=u?r=r<c?r=Math.min(c,r+1):r:v<u&&(c=c>r?c=Math.max(r,c-1):c),o.zoomCumulativeDelta=0),e.options.ticks.min=d(t,i[r]),e.options.ticks.max=m(t,i[c]))},o.zoomFunctions.time=function(e,n,o,a){c(e,n,o,a)},o.zoomFunctions.linear=c,o.zoomFunctions.logarithmic=c,o.panFunctions.category=function(e,n,a){var t,i=e.chart.data.labels,r=i.length-1,l=Math.max(e.ticks.length,1),c=a.speed,s=e.minIndex,u=Math.round(e.width/(l*c));o.panCumulativeDelta+=n,s=o.panCumulativeDelta>u?Math.max(0,s-1):o.panCumulativeDelta<-u?Math.min(r-l+1,s+1):s,o.panCumulativeDelta=s!==e.minIndex?0:o.panCumulativeDelta,t=Math.min(r,s+l-1),e.options.ticks.min=d(a,i[s]),e.options.ticks.max=m(a,i[t])},o.panFunctions.time=function(e,n,o){v(e,n,o)},o.panFunctions.linear=v,o.panFunctions.logarithmic=v,o.panCumulativeDelta=0,o.zoomCumulativeDelta=0,o.zoomPercentage;var h={id:"advancedzoom",afterDatasetUpdate:function(e,n){},afterInit:function(e){e.resetZoom=function(){r(e);var o=e.$advancedzoom._originalOptions;n.each(e.scales,function(e){var n=e.options.time,a=e.options.ticks;o[e.id]?(a.min=o[e.id].ticks.min,a.max=o[e.id].ticks.max):(n&&(delete n.min,delete n.max),a&&(delete a.min,delete a.max))}),e.update()},e.update(0)},beforeRender:function(e,n){},beforeUpdate:function(e,n){i(e,n)},beforeInit:function(n,a){n.$advancedzoom={_originalOptions:{}};var t=n.$advancedzoom._node=n.ctx.canvas;i(n,a),n.$advancedzoom._options=a;var r=a.pan&&a.pan.threshold;n.$advancedzoom._mouseDownHandler=function(e){t.addEventListener("mousemove",n.$advancedzoom._mouseMoveHandler),0==e.button?n.$advancedzoom.panning=!0:n.$advancedzoom._dragZoomStart=e,e.preventDefault()},n.$advancedzoom._mouseMoveHandler=function(e){n.$advancedzoom.panning?p(n,e.movementX,e.movementY):n.$advancedzoom._dragZoomStart&&(n.$advancedzoom._dragZoomEnd=e)},n.$advancedzoom._mouseUpHandler=function(e){if(t.removeEventListener("mousemove",n.$advancedzoom._mouseMoveHandler),0==e.button)return n.$advancedzoom.panning=!1,void e.preventDefault();if(n.$advancedzoom._dragZoomStart){var o=n.$advancedzoom._dragZoomStart,a=o.target.getBoundingClientRect().left,i=Math.min(o.clientX,e.clientX)-a,r=Math.max(o.clientX,e.clientX)-a,m=o.target.getBoundingClientRect().top,d=Math.min(o.clientY,e.clientY)-m,c=r-i,s=Math.max(o.clientY,e.clientY)-m-d;if(n.$advancedzoom._dragZoomStart=null,n.$advancedzoom._dragZoomEnd=null,!(c<=0&&s<=0)){var v=n.chartArea,f=n.$advancedzoom._options.zoom,p=v.right-v.left,h=l(f.mode,"x")&&c?1+(p-c)/p:1,g=v.bottom-v.top,x=l(f.mode,"y");u(n,h,x&&s?1+(g-s)/g:1,{x:(i-v.left)/(1-c/p)+v.left,y:(d-v.top)/(1-s/g)+v.top}),"function"==typeof f.onZoomComplete&&f.onZoomComplete({chart:n})}}};var m=null;if(n.$advancedzoom._wheelHandler=function(e){var o=e.target.getBoundingClientRect(),a={x:e.clientX-o.left,y:e.clientY-o.top},t=n.$advancedzoom._options.zoom,i=t.speed;e.deltaY>=0&&(i=-i),u(n,1+i,1+i,a),clearTimeout(m),m=setTimeout(function(){"function"==typeof t.onZoomComplete&&t.onZoomComplete({chart:n})},250),e.cancelable&&e.preventDefault()},e){var d,c=new e.Manager(t);c.add(new e.Pinch),c.add(new e.Pan({threshold:r}));var s=function(e){var o=1/d*e.scale,a=e.target.getBoundingClientRect(),t={x:e.center.x-a.left,y:e.center.y-a.top},i=Math.abs(e.pointers[0].clientX-e.pointers[1].clientX),r=Math.abs(e.pointers[0].clientY-e.pointers[1].clientY),l=i/r;u(n,o,o,t,l>.3&&l<1.7?"xy":i>r?"x":"y"),d=e.scale};c.on("pinchstart",function(){d=1}),c.on("pinch",s),c.on("pinchend",function(e){s(e),d=null,o.zoomCumulativeDelta=0});var v=null,f=null,h=!1,g=function(e){if(null!==v&&null!==f){h=!0;var o=e.deltaX-v,a=e.deltaY-f;v=e.deltaX,f=e.deltaY,p(n,o,a)}};c.on("panstart",function(e){v=0,f=0,g(e)}),c.on("panmove",g),c.on("panend",function(){v=null,f=null,o.panCumulativeDelta=0,setTimeout(function(){h=!1},500);var e=n.$advancedzoom._options.pan;"function"==typeof e.onPanComplete&&e.onPanComplete({chart:n})}),n.$advancedzoom._ghostClickHandler=function(e){h&&e.cancelable&&(e.stopImmediatePropagation(),e.preventDefault())},t.addEventListener("click",n.$advancedzoom._ghostClickHandler),n._mc=c}},beforeDatasetsDraw:function(e){var n=e.ctx;if(e.$advancedzoom._dragZoomEnd){var o=function(e){for(var n=e.scales,o=Object.keys(n),a=0;a<o.length;a++){var t=n[o[a]];if(t.isHorizontal())return t}}(e),a=function(e){for(var n=e.scales,o=Object.keys(n),a=0;a<o.length;a++){var t=n[o[a]];if(!t.isHorizontal())return t}}(e),t=e.$advancedzoom._dragZoomStart,i=e.$advancedzoom._dragZoomEnd,r=o.left,m=o.right,d=a.top,c=a.bottom;if(l(e.$advancedzoom._options.zoom.mode,"x")){var s=t.target.getBoundingClientRect().left;r=Math.min(t.clientX,i.clientX)-s,m=Math.max(t.clientX,i.clientX)-s}if(l(e.$advancedzoom._options.zoom.mode,"y")){var u=t.target.getBoundingClientRect().top;d=Math.min(t.clientY,i.clientY)-u,c=Math.max(t.clientY,i.clientY)-u}var v=m-r,f=c-d,p=e.$advancedzoom._options.zoom.drag;n.save(),n.beginPath(),n.fillStyle=p.backgroundColor||"rgba(225,225,225,0.3)",n.fillRect(r,d,v,f),p.borderWidth>0&&(n.lineWidth=p.borderWidth,n.strokeStyle=p.borderColor||"rgba(225,225,225)",n.strokeRect(r,d,v,f)),n.restore()}},destroy:function(e){if(e.$advancedzoom){var n=e.$advancedzoom,o=Chart.node;o.removeEventListener("mousedown",n._mouseDownHandler),o.removeEventListener("mousemove",n._mouseMoveHandler),o.ownerDocument.removeEventListener("mouseup",n._mouseUpHandler),o.removeEventListener("wheel",n._wheelHandler),o.removeEventListener("click",n._ghostClickHandler),delete e.$advancedzoom;var a=e._mc;a&&(a.remove("pinchstart"),a.remove("pinch"),a.remove("pinchend"),a.remove("panstart"),a.remove("pan"),a.remove("panend"))}}};return Chart.plugins.register(h),h});
