/*!
 * @license
 * chartjs-plugin-advancedzoom
 * http://chartjs.org/
 * Version: 0.7.3
 *
 * Copyright 2019 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-plugin-advancedzoom/blob/master/LICENSE.md
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("hammerjs")):"function"==typeof define&&define.amd?define(["hammerjs"],n):(e=e||self).ChartAdvancedZoom=n(e.Hammer)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var n=Chart.helpers,o=Chart.AdvancedZoom=Chart.AdvancedZoom||{};var t=o.zoomFunctions=o.zoomFunctions||{},a=o.panFunctions=o.panFunctions||{};function i(e,n){var o=e.$advancedzoom._node=e.ctx.canvas,t=e.$advancedzoom;e.$advancedzoom._options=n;var a=n.zoom&&n.zoom.enabled,i=n.zoom.drag;a?(o.addEventListener("wheel",t._wheelHandler),i&&(o.addEventListener("mousedown",t._mouseDownHandler),o.ownerDocument.addEventListener("mouseup",t._mouseUpHandler))):(o.removeEventListener("wheel",t._wheelHandler),o.removeEventListener("mousedown",t._mouseDownHandler),o.removeEventListener("mousemove",t._mouseMoveHandler),o.ownerDocument.removeEventListener("mouseup",t._mouseUpHandler))}function r(e){var o=e.$advancedzoom._originalOptions;n.each(e.scales,function(e){o[e.id]||(o[e.id]=n.clone(e.options))}),n.each(o,function(n,t){e.scales[t]||delete o[t]})}function m(e,n){return void 0===e||"string"==typeof e&&-1!==e.indexOf(n)}function l(e,o){if(e.scaleAxes&&e.rangeMax&&!n.isNullOrUndef(e.rangeMax[e.scaleAxes])){var t=e.rangeMax[e.scaleAxes];o>t&&(o=t)}return o}function d(e,o){if(e.scaleAxes&&e.rangeMin&&!n.isNullOrUndef(e.rangeMin[e.scaleAxes])){var t=e.rangeMin[e.scaleAxes];o<t&&(o=t)}return o}function c(e,n,o,t){var a=e.max-e.min,i=a*(n-1),r=e.isHorizontal()?o.x:o.y,m=(e.getValueForPixel(r)-e.min)/a,c=i*m,s=i*(1-m);e.options.ticks.min=d(t,e.min+c),e.options.ticks.max=l(t,e.max-s)}function s(e,n,o,a){var i=t[e.type];i&&i(e,n,o,a)}function u(e,o,t,a,i,l){var d=e.chartArea;a||(a={x:(d.left+d.right)/2,y:(d.top+d.bottom)/2}),void 0===l&&(l=!0);var c=e.$advancedzoom._options.zoom;if(c.enabled){r(e);var u,v=c.mode;u="xy"===v&&void 0!==i?i:"xy",n.each(e.scales,function(e){e.isHorizontal()&&m(v,"x")&&m(u,"x")?(c.scaleAxes="x",s(e,o,a,c)):!e.isHorizontal()&&m(v,"y")&&m(u,"y")&&(c.scaleAxes="y",s(e,t,a,c))}),l&&e.update(0),"function"==typeof c.onZoom&&c.onZoom({chart:e})}}function v(e,o,t){var a,i=e.options.ticks,r=e.min,m=e.max,l=e.getValueForPixel(e.getPixelForValue(r)-o),d=e.getValueForPixel(e.getPixelForValue(m)-o),c=l=l.valueOf?l.valueOf():l,s=d=d.valueOf?d.valueOf():d;t.scaleAxes&&t.rangeMin&&!n.isNullOrUndef(t.rangeMin[t.scaleAxes])&&(c=t.rangeMin[t.scaleAxes]),t.scaleAxes&&t.rangeMax&&!n.isNullOrUndef(t.rangeMax[t.scaleAxes])&&(s=t.rangeMax[t.scaleAxes]),l>=c&&d<=s?(i.min=l,i.max=d):l<c?(a=r-c,i.min=c,i.max=m-a):d>s&&(a=s-m,i.max=s,i.min=r+a)}function p(e,n,o){var t=a[e.type];t&&t(e,n,o)}function f(e,o,t){r(e);var a=e.$advancedzoom._options.pan;if(a.enabled){var i=a.mode;n.each(e.scales,function(e){e.isHorizontal()&&m(i,"x")&&0!==o?(a.scaleAxes="x",p(e,o,a)):!e.isHorizontal()&&m(i,"y")&&0!==t&&(a.scaleAxes="y",p(e,t,a))}),e.update(0),"function"==typeof a.onPan&&a.onPan({chart:e})}}Chart.AdvancedZoom.defaults=Chart.defaults.global.plugins.advancedzoom={pan:{enabled:!1,mode:"xy",speed:20,threshold:10},zoom:{enabled:!0,mode:"x",sensitivity:3,speed:.1}},o.zoomFunctions.category=function(e,n,t,a){var i=e.chart.data.labels,r=e.minIndex,m=i.length-1,c=e.maxIndex,s=a.sensitivity,u=e.isHorizontal()?e.left+e.width/2:e.top+e.height/2,v=e.isHorizontal()?t.x:t.y;o.zoomCumulativeDelta=n>1?o.zoomCumulativeDelta+1:o.zoomCumulativeDelta-1,Math.abs(o.zoomCumulativeDelta)>s&&(o.zoomCumulativeDelta<0?(v>=u?r<=0?c=Math.min(m,c+1):r=Math.max(0,r-1):v<u&&(c>=m?r=Math.max(0,r-1):c=Math.min(m,c+1)),o.zoomCumulativeDelta=0):o.zoomCumulativeDelta>0&&(v>=u?r=r<c?r=Math.min(c,r+1):r:v<u&&(c=c>r?c=Math.max(r,c-1):c),o.zoomCumulativeDelta=0),e.options.ticks.min=d(a,i[r]),e.options.ticks.max=l(a,i[c]))},o.zoomFunctions.time=function(e,n,o,t){c(e,n,o,t),e.options.time.min=e.options.ticks.min,e.options.time.max=e.options.ticks.max},o.zoomFunctions.linear=c,o.zoomFunctions.logarithmic=c,o.panFunctions.category=function(e,n,t){var a,i=e.chart.data.labels,r=i.length-1,m=Math.max(e.ticks.length,1),c=t.speed,s=e.minIndex,u=Math.round(e.width/(m*c));o.panCumulativeDelta+=n,s=o.panCumulativeDelta>u?Math.max(0,s-1):o.panCumulativeDelta<-u?Math.min(r-m+1,s+1):s,o.panCumulativeDelta=s!==e.minIndex?0:o.panCumulativeDelta,a=Math.min(r,s+m-1),e.options.ticks.min=d(t,i[s]),e.options.ticks.max=l(t,i[a])},o.panFunctions.time=function(e,n,o){v(e,n,o);var t=e.options;t.time.min=t.ticks.min,t.time.max=t.ticks.max},o.panFunctions.linear=v,o.panFunctions.logarithmic=v,o.panCumulativeDelta=0,o.zoomCumulativeDelta=0,o.zoomPercentage;var h={id:"advancedzoom",afterDatasetUpdate:function(e,n){},afterInit:function(e){e.resetZoom=function(){r(e);var o=e.$advancedzoom._originalOptions;n.each(e.scales,function(e){var n=e.options.time,t=e.options.ticks;o[e.id]?(n&&(n.min=o[e.id].time.min,n.max=o[e.id].time.max),t&&(t.min=o[e.id].ticks.min,t.max=o[e.id].ticks.max)):(n&&(delete n.min,delete n.max),t&&(delete t.min,delete t.max))}),e.update()},e.update(0);var o=1+e.$advancedzoom._options.timespan,t={x:(e.chartArea.right-e.chartArea.left)/2,y:(e.chartArea.bottom+e.chartArea.top)/2};u(e,o,1,t,"x",!1)},beforeRender:function(e,n){},beforeUpdate:function(e,n){i(e,n)},beforeInit:function(n,t){n.$advancedzoom={_originalOptions:{}};var a=n.$advancedzoom._node=n.ctx.canvas;i(n,t),n.$advancedzoom._options=t;var r=t.pan&&t.pan.threshold;n.$advancedzoom._mouseDownHandler=function(e){a.addEventListener("mousemove",n.$advancedzoom._mouseMoveHandler),0==e.button?n.$advancedzoom.panning=!0:n.$advancedzoom._dragZoomStart=e,e.preventDefault()},n.$advancedzoom._mouseMoveHandler=function(e){n.$advancedzoom.panning?f(n,e.movementX,e.movementY):n.$advancedzoom._dragZoomStart&&(n.$advancedzoom._dragZoomEnd=e)},n.$advancedzoom._mouseUpHandler=function(e){if(a.removeEventListener("mousemove",n.$advancedzoom._mouseMoveHandler),0==e.button)return n.$advancedzoom.panning=!1,void e.preventDefault();if(n.$advancedzoom._dragZoomStart){var o=n.$advancedzoom._dragZoomStart,t=o.target.getBoundingClientRect().left,i=Math.min(o.clientX,e.clientX)-t,r=Math.max(o.clientX,e.clientX)-t,l=o.target.getBoundingClientRect().top,d=Math.min(o.clientY,e.clientY)-l,c=r-i,s=Math.max(o.clientY,e.clientY)-l-d;if(n.$advancedzoom._dragZoomStart=null,n.$advancedzoom._dragZoomEnd=null,!(c<=0&&s<=0)){var v=n.chartArea,p=n.$advancedzoom._options.zoom,f=v.right-v.left,h=m(p.mode,"x")&&c?1+(f-c)/f:1,x=v.bottom-v.top,g=m(p.mode,"y");u(n,h,g&&s?1+(x-s)/x:1,{x:(i-v.left)/(1-c/f)+v.left,y:(d-v.top)/(1-s/x)+v.top}),"function"==typeof p.onZoomComplete&&p.onZoomComplete({chart:n})}}};var l=null;if(n.$advancedzoom._wheelHandler=function(e){var o=e.target.getBoundingClientRect(),t={x:e.clientX-o.left,y:e.clientY-o.top},a=n.$advancedzoom._options.zoom,i=a.speed;e.deltaY>=0&&(i=-i),u(n,1+i,1+i,t),clearTimeout(l),l=setTimeout(function(){"function"==typeof a.onZoomComplete&&a.onZoomComplete({chart:n})},250),e.cancelable&&e.preventDefault()},e){var d,c=new e.Manager(a);c.add(new e.Pinch),c.add(new e.Pan({threshold:r}));var s=function(e){var o=1/d*e.scale,t=e.target.getBoundingClientRect(),a={x:e.center.x-t.left,y:e.center.y-t.top},i=Math.abs(e.pointers[0].clientX-e.pointers[1].clientX),r=Math.abs(e.pointers[0].clientY-e.pointers[1].clientY),m=i/r;u(n,o,o,a,m>.3&&m<1.7?"xy":i>r?"x":"y"),d=e.scale};c.on("pinchstart",function(){d=1}),c.on("pinch",s),c.on("pinchend",function(e){s(e),d=null,o.zoomCumulativeDelta=0});var v=null,p=null,h=!1,x=function(e){if(null!==v&&null!==p){h=!0;var o=e.deltaX-v,t=e.deltaY-p;v=e.deltaX,p=e.deltaY,f(n,o,t)}};c.on("panstart",function(e){v=0,p=0,x(e)}),c.on("panmove",x),c.on("panend",function(){v=null,p=null,o.panCumulativeDelta=0,setTimeout(function(){h=!1},500);var e=n.$advancedzoom._options.pan;"function"==typeof e.onPanComplete&&e.onPanComplete({chart:n})}),n.$advancedzoom._ghostClickHandler=function(e){h&&e.cancelable&&(e.stopImmediatePropagation(),e.preventDefault())},a.addEventListener("click",n.$advancedzoom._ghostClickHandler),n._mc=c}},beforeDatasetsDraw:function(e){var n=e.ctx;if(e.$advancedzoom._dragZoomEnd){var o=function(e){for(var n=e.scales,o=Object.keys(n),t=0;t<o.length;t++){var a=n[o[t]];if(a.isHorizontal())return a}}(e),t=function(e){for(var n=e.scales,o=Object.keys(n),t=0;t<o.length;t++){var a=n[o[t]];if(!a.isHorizontal())return a}}(e),a=e.$advancedzoom._dragZoomStart,i=e.$advancedzoom._dragZoomEnd,r=o.left,l=o.right,d=t.top,c=t.bottom;if(m(e.$advancedzoom._options.zoom.mode,"x")){var s=a.target.getBoundingClientRect().left;r=Math.min(a.clientX,i.clientX)-s,l=Math.max(a.clientX,i.clientX)-s}if(m(e.$advancedzoom._options.zoom.mode,"y")){var u=a.target.getBoundingClientRect().top;d=Math.min(a.clientY,i.clientY)-u,c=Math.max(a.clientY,i.clientY)-u}var v=l-r,p=c-d,f=e.$advancedzoom._options.zoom.drag;n.save(),n.beginPath(),n.fillStyle=f.backgroundColor||"rgba(225,225,225,0.3)",n.fillRect(r,d,v,p),f.borderWidth>0&&(n.lineWidth=f.borderWidth,n.strokeStyle=f.borderColor||"rgba(225,225,225)",n.strokeRect(r,d,v,p)),n.restore()}},destroy:function(e){if(e.$advancedzoom){var n=e.$advancedzoom,o=Chart.node;o.removeEventListener("mousedown",n._mouseDownHandler),o.removeEventListener("mousemove",n._mouseMoveHandler),o.ownerDocument.removeEventListener("mouseup",n._mouseUpHandler),o.removeEventListener("wheel",n._wheelHandler),o.removeEventListener("click",n._ghostClickHandler),delete e.$advancedzoom;var t=e._mc;t&&(t.remove("pinchstart"),t.remove("pinch"),t.remove("pinchend"),t.remove("panstart"),t.remove("pan"),t.remove("panend"))}}};return Chart.plugins.register(h),h});
